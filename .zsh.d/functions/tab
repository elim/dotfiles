# Open new Terminal tabs from the command line
#
# Original Author: Justin Hileman (http://justinhileman.com)
# https://gist.github.com/bobthecow/757788
#
# Usage:
#     tab                   Opens the current directory in a new tab
#     tab [PATH]            Open PATH in a new tab
#     tab [CMD]             Open a new tab and execute CMD
#     tab [PATH] [CMD] ...  You can prob'ly guess

# Only for teh Mac users
[ `uname -s` != "Darwin" ] && return

local cmd=""
local cdto="$PWD"
local session_name=""
local args="$@"

if [ -d "$1" ]; then
    cdto=$(chpwd_functions= cd "${1}" &>/dev/null; pwd)
    args="${@:2}"
fi

session_name=$(echo $(basename ${cdto}) | sed -e 's|\.|-|')

if [ -n "$args" ]; then
    cmd="$args"
fi

osascript &>/dev/null <<EOF
    tell application "iTerm"
        tell current terminal
            launch session "Default Session"
            tell the last session
                write text " cd \"${cdto}\"; title \"${session_name}\" && exec tmux new-session -D -s \"${session_name}\" ${cmd}"
                write text ""
            end tell
        end tell
    end tell
EOF

# Local Variables:
# mode: sh
# End:
